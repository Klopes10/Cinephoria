<div class="film-grid">
  {% if films is not empty %}
    {% for film in films %}
      {# film peut être une entité Film ou un objet { entity: Film, noteMoy, nbAvis } #}
      {% set f     = film.entity is defined ? film.entity : film %}
      {% set note  = film.noteMoy is defined ? film.noteMoy : null %}

      <article class="film-horizontal-card"
         data-film-id="{{ f.id }}"
         data-genre="{{ (f.genre is defined and f.genre) ? f.genre.nom : '' }}">
         
        <div class="film-poster">
          {# Badge coup de cœur #}
          {% if f.coupDeCoeur %}
            <div class="badge">
              Coup de cœur
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
              </svg>
            </div>
          {% endif %}

          {% if f.affiche %}
            <img src="{{ asset('uploads/affiches/' ~ f.affiche) }}" alt="{{ f.titre }}">
          {% else %}
            <img src="{{ asset('images/placeholder.jpg') }}" alt="{{ f.titre }}">
          {% endif %}
        </div>

        <div class="film-info">
          <h2>
            <a href="{{ path('app_films_show', { id: f.id }) }}" style="color:inherit;text-decoration:none">
              {{ f.titre }}
            </a>
          </h2>

          <div class="public">
            {% if f.ageMinimum is not null %}
              - {{ f.ageMinimum }} ans
            {% else %}
              Tout public
            {% endif %}
            {% if f.genre is defined and f.genre %}
              &nbsp;|&nbsp;{{ f.genre.nom }}
            {% endif %}
          </div>

          {% if f.synopsis %}
            <p class="desc">
              {{ f.synopsis|length > 210 ? f.synopsis|slice(0, 210) ~ '…' : f.synopsis }}
            </p>
          {% endif %}

          <div class="note">
            <span>Note :</span>

            {% if note is not null %}
              {% set n     = note + 0 %}
              {% set n     = n < 0 ? 0 : (n > 5 ? 5 : n) %}
              {% set full  = n|round(0, 'floor') %}
              {% set half  = (n - full) >= 0.5 ? 1 : 0 %}
              {% set empty = 5 - full - half %}

              <span class="stars">
                {% for i in 1..full %}
                  <span class="star"><img src="{{ asset('images/icons/etoile_pleine.svg') }}" alt="★"></span>
                {% endfor %}
                {% if half %}
                  <span class="star half"><img src="{{ asset('images/icons/Star-Half.svg') }}" alt="☆"></span>
                {% endif %}
                {% for i in 1..empty %}
                  <span class="star empty"><img src="{{ asset('images/icons/etoile_vide.svg') }}" alt="☆"></span>
                {% endfor %}
              </span>
            {% else %}
              <span class="stars">
                {% for i in 1..5 %}
                  <span class="star empty"><img src="{{ asset('images/icons/etoile_vide.svg') }}" alt="☆"></span>
                {% endfor %}
              </span>
            {% endif %}
          </div>
        </div>
      </article>
    {% endfor %}
  {% else %}
    <p>Aucun film à afficher.</p>
  {% endif %}
</div>
