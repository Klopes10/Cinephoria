{% extends 'base.html.twig' %}

{% block title %}Réinitialiser le mot de passe{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('css/auth.css') }}">
{% endblock %}

{% block body %}
<div class="auth-wrapper">
  <div class="auth-container">

    <div class="auth-tabs">
      <h1 class="tab active">Définir un nouveau mot de passe</h1>
    </div>

    <div class="auth-forms">
      <div class="auth-form-section">

        {# Toasts / flashes #}
        <div id="flash-toasts" class="toast-container">
          {% for msg in app.flashes('success') %}
            <div class="toast toast-success" role="status" aria-live="polite">
              <span class="toast-msg">{{ msg }}</span>
              <button class="toast-close" aria-label="Fermer">×</button>
            </div>
          {% endfor %}
          {% for msg in app.flashes('error') %}
            <div class="toast toast-error" role="alert" aria-live="assertive">
              <span class="toast-msg">{{ msg }}</span>
              <button class="toast-close" aria-label="Fermer">×</button>
            </div>
          {% endfor %}
        </div>

        {{ form_start(resetForm, {'attr': {'class': 'auth-form'}}) }}
          <div class="form-group">
            {{ form_label(resetForm.plainPassword.first, 'Nouveau mot de passe') }}
            {{ form_widget(resetForm.plainPassword.first, { attr: { placeholder: 'Au moins 8 caractères' } }) }}
            {{ form_errors(resetForm.plainPassword.first) }}
          </div>

          <div class="form-group">
            {{ form_label(resetForm.plainPassword.second, 'Confirmez le mot de passe') }}
            {{ form_widget(resetForm.plainPassword.second) }}
            {{ form_errors(resetForm.plainPassword.second) }}
          </div>

          <button type="submit">Mettre à jour</button>
        {{ form_end(resetForm) }}

      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    // close buttons for toasts
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.toast-close');
      if (!btn) return;
      const toast = btn.closest('.toast');
      toast?.classList.add('hide');
      setTimeout(() => toast?.remove(), 200);
    });
  </script>
{% endblock %}
