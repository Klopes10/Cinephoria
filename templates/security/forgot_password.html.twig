{% extends 'base.html.twig' %}

{% block title %}Mot de passe oublié{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('css/auth.css') }}">
{% endblock %}

{% block body %}
<div class="auth-wrapper">
  <div class="auth-container">

    <div class="auth-tabs">
      <h1 class="tab active">Mot de passe oublié</h1>
    </div>

    <div class="auth-forms">
      <div class="auth-form-section">

        {# Toasts / flashes #}
        <div id="flash-toasts" class="toast-container">
          {% for msg in app.flashes('success') %}
            <div class="toast toast-success" role="status" aria-live="polite">
              <span class="toast-msg">{{ msg }}</span>
              <button class="toast-close" aria-label="Fermer">×</button>
            </div>
          {% endfor %}
          {% for msg in app.flashes('error') %}
            <div class="toast toast-error" role="alert" aria-live="assertive">
              <span class="toast-msg">{{ msg }}</span>
              <button class="toast-close" aria-label="Fermer">×</button>
            </div>
          {% endfor %}
        </div>

        {{ form_start(requestForm, {'attr': {'class': 'auth-form'}}) }}
          <div class="form-group">
            {{ form_label(requestForm.email, 'Adresse e-mail') }}
            {{ form_widget(requestForm.email, { attr: { placeholder: 'votre@email.com' } }) }}
            {{ form_errors(requestForm.email) }}
          </div>

          <button type="submit">Envoyer le lien de réinitialisation</button>
        {{ form_end(requestForm) }}

        <p style="opacity:.7;margin-top:1rem">
          Si un compte existe pour cet email, vous recevrez un lien (valable 1h).
        </p>

      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    // close buttons for toasts
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.toast-close');
      if (!btn) return;
      const toast = btn.closest('.toast');
      toast?.classList.add('hide');
      setTimeout(() => toast?.remove(), 200);
    });
  </script>
{% endblock %}
